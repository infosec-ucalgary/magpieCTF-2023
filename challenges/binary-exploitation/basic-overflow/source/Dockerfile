FROM nsjailcontainer
RUN apt-get install -y apt-transport-https&& apt-get update && apt-get install -y gcc-multilib
ARG USERNAME=magpie
RUN useradd -m $USERNAME
RUN chmod a-w /home/$USERNAME
COPY . /home/magpie
RUN chmod o+x ./home/$USERNAME
RUN gcc -o /home/magpie/vuln /home/magpie/vuln.c -m32 -fno-stack-protector -no-pie 

EXPOSE 6201
CMD ["bin/nsjail", "-Ml", "--hostname", "localhost", "--port", "6201","--user", "1001", "--group", "1001", "--chroot", "/", "-E", "TERM=xterm", "--cwd", "/home/magpie", "--","/home/magpie/vuln"]
